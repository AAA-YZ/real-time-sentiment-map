<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶èˆ†æƒ…æ°”è±¡å›¾ - ç™¾åº¦åœ°å›¾APIå¤§èµ›ä½œå“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            background: #1a1a1a;
        }
        #map-container {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            background: #2d2d2d;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            z-index: 1000;
        }
        #control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            min-width: 250px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
        }
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            border-left: 3px solid #1890ff;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½æç¤º -->
    <div id="loading">
        <h2>ğŸŒ å®æ—¶èˆ†æƒ…æ°”è±¡å›¾</h2>
        <p>æ­£åœ¨åˆå§‹åŒ–åœ°å›¾ç³»ç»Ÿ...</p>
        <div id="debug-status" style="margin-top: 10px; font-size: 14px; color: #ffa940;">
            çŠ¶æ€: ç­‰å¾…ç™¾åº¦åœ°å›¾APIåŠ è½½
        </div>
    </div>

    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="map-container"></div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div id="control-panel">
        <h3>ğŸ¯ èˆ†æƒ…æ°”è±¡å›¾æ§åˆ¶å°</h3>
        <div style="margin: 10px 0;">
            <span style="color: #ff4d4f;">â— ç§¯ææƒ…ç»ª</span><br>
            <span style="color: #1890ff;">â— æ¶ˆææƒ…ç»ª</span><br>
            <span style="color: #52c41a;">â— ä¸­æ€§æƒ…ç»ª</span>
        </div>
        
        <div class="debug-info">
            <strong>è°ƒè¯•ä¿¡æ¯:</strong><br>
            é¡µé¢åŠ è½½: <span id="page-load-status">âœ… å®Œæˆ</span><br>
            ç™¾åº¦åœ°å›¾API: <span id="bmap-status">â³ æ£€æµ‹ä¸­...</span><br>
            AKçŠ¶æ€: <span id="ak-status">â³ æ£€æµ‹ä¸­...</span><br>
            æœ€åæ›´æ–°: <span id="update-time">--:--:--</span>
        </div>
    </div>

    <!-- æ›¿æ¢ YOUR_ACTUAL_AK ä¸ºä½ çš„çœŸå®ç™¾åº¦åœ°å›¾AK -->
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=VHQjLiBuy6LwHD6UI3jksj4jS8WZlZ5N"></script>
    
    <script>
        // è°ƒè¯•æ—¥å¿—
        console.log('ğŸ”§ å¼€å§‹åˆå§‹åŒ–èˆ†æƒ…åœ°å›¾é¡¹ç›®...');
        
        let debugStatus = document.getElementById('debug-status');
        let bmapStatus = document.getElementById('bmap-status');
        let akStatus = document.getElementById('ak-status');
        let loadingElement = document.getElementById('loading');

        // æ›´æ–°çŠ¶æ€å‡½æ•°
        function updateStatus(element, message, type = 'info') {
            const colors = {
                success: '#52c41a',
                error: '#ff4d4f', 
                warning: '#faad14',
                info: '#1890ff'
            };
            
            element.innerHTML = message;
            element.style.color = colors[type] || colors.info;
            console.log(`çŠ¶æ€æ›´æ–° [${type}]:`, message);
        }

        // æ£€æŸ¥ç™¾åº¦åœ°å›¾APIåŠ è½½çŠ¶æ€
        function checkBMapStatus() {
            if (typeof BMap !== 'undefined') {
                updateStatus(bmapStatus, 'âœ… åŠ è½½æˆåŠŸ', 'success');
                updateStatus(akStatus, 'âœ… AKæœ‰æ•ˆ', 'success');
                return true;
            } else {
                updateStatus(bmapStatus, 'âŒ åŠ è½½å¤±è´¥', 'error');
                updateStatus(akStatus, 'âŒ AKå¯èƒ½æ— æ•ˆ', 'error');
                return false;
            }
        }

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            console.log('ğŸ—ºï¸ å¼€å§‹åˆå§‹åŒ–åœ°å›¾...');
            updateStatus(debugStatus, 'æ­£åœ¨åˆ›å»ºåœ°å›¾å®ä¾‹...', 'info');
            
            try {
                // åˆ›å»ºåœ°å›¾å®ä¾‹
                const map = new BMap.Map('map-container');
                console.log('âœ… åœ°å›¾å®ä¾‹åˆ›å»ºæˆåŠŸ');
                
                // è®¾ç½®åœ°å›¾ä¸­å¿ƒç‚¹ï¼ˆä¸­å›½ä¸­å¿ƒï¼‰
                const point = new BMap.Point(104.0, 35.0);
                map.centerAndZoom(point, 5);
                console.log('âœ… åœ°å›¾ä¸­å¿ƒç‚¹è®¾ç½®æˆåŠŸ');
                
                // å¯ç”¨äº¤äº’
                map.enableScrollWheelZoom(true);
                map.enableDragging();
                console.log('âœ… åœ°å›¾äº¤äº’åŠŸèƒ½å¯ç”¨');
                
                // æ·»åŠ å¯¼èˆªæ§ä»¶
                map.addControl(new BMap.NavigationControl());
                console.log('âœ… å¯¼èˆªæ§ä»¶æ·»åŠ æˆåŠŸ');
                
                // éšè—åŠ è½½æç¤º
                loadingElement.style.display = 'none';
                updateStatus(debugStatus, 'âœ… åœ°å›¾åˆå§‹åŒ–å®Œæˆï¼', 'success');
                
                // æ·»åŠ æµ‹è¯•æ ‡è®°
                addTestMarkers(map);
                
            } catch (error) {
                console.error('åœ°å›¾åˆå§‹åŒ–é”™è¯¯:', error);
                updateStatus(debugStatus, `âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                
                // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
                loadingElement.innerHTML = `
                    <h2>âŒ åœ°å›¾åŠ è½½å¤±è´¥</h2>
                    <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    <p style="font-size: 14px; margin-top: 10px;">
                        è¯·æ£€æŸ¥ï¼š<br>
                        1. ç™¾åº¦åœ°å›¾AKæ˜¯å¦æ­£ç¡®<br>
                        2. ç™½åå•æ˜¯å¦åŒ…å«: aaa-yz.github.io<br>
                        3. AKæ˜¯å¦é€šè¿‡å®¡æ ¸
                    </p>
                `;
            }
        }

        // æ·»åŠ æµ‹è¯•æ ‡è®°
        function addTestMarkers(map) {
            const cities = [
                { name: 'åŒ—äº¬', lng: 116.404, lat: 39.915 },
                { name: 'ä¸Šæµ·', lng: 121.475, lat: 31.235 },
                { name: 'å¹¿å·', lng: 113.264, lat: 23.129 },
                { name: 'æ·±åœ³', lng: 114.057, lat: 22.543 }
            ];
            
            cities.forEach(city => {
                const point = new BMap.Point(city.lng, city.lat);
                const marker = new BMap.Marker(point);
                map.addOverlay(marker);
                
                // æ·»åŠ ä¿¡æ¯çª—å£
                const infoWindow = new BMap.InfoWindow(`
                    <div style="min-width: 200px;">
                        <h4>${city.name}</h4>
                        <p>ğŸ“Š æ¨¡æ‹Ÿèˆ†æƒ…æ•°æ®</p>
                        <p>ğŸ˜Š ç§¯æ: 65%</p>
                        <p>ğŸ˜ ä¸­æ€§: 20%</p>
                        <p>ğŸ˜ æ¶ˆæ: 15%</p>
                    </div>
                `);
                
                marker.addEventListener('click', function() {
                    this.openInfoWindow(infoWindow);
                });
            });
            
            console.log('âœ… æµ‹è¯•æ ‡è®°æ·»åŠ å®Œæˆ');
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            document.getElementById('update-time').textContent = now.toLocaleTimeString();
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            updateTime();
            setInterval(updateTime, 1000);
            
            // æ£€æŸ¥ç™¾åº¦åœ°å›¾APIçŠ¶æ€
            const checkInterval = setInterval(() => {
                if (checkBMapStatus()) {
                    clearInterval(checkInterval);
                    // APIåŠ è½½æˆåŠŸï¼Œåˆå§‹åŒ–åœ°å›¾
                    setTimeout(initMap, 500);
                }
            }, 1000);
            
            // 10ç§’åå¦‚æœè¿˜æ²¡åŠ è½½æˆåŠŸï¼Œæ˜¾ç¤ºé”™è¯¯
            setTimeout(() => {
                if (typeof BMap === 'undefined') {
                    updateStatus(debugStatus, 'âŒ ç™¾åº¦åœ°å›¾APIåŠ è½½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå’ŒAKé…ç½®', 'error');
                    clearInterval(checkInterval);
                }
            }, 10000);
        };

        // å…¨å±€é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            console.error('å…¨å±€é”™è¯¯:', e.error);
            updateStatus(debugStatus, `âŒ é¡µé¢é”™è¯¯: ${e.message}`, 'error');
        });
    </script>
</body>
</html>
